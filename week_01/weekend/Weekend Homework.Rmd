---
title: "Week 1 - weekend homework"
output: html_notebook
---

# Weekend Homework

First steps  
Load necessary packages and read in books.csv. Investigate dimensions, variables, missing values - you know the drill!

Up to you  
Now it’s up to you… For this weekend homework there will be no specific tasks, just you and this dataset! Using everything you’ve learned this week, try to describe/summarise at least 5 things about this dataset - using R and the tidyverse of course! Feel free to find and use new functions if there is something that the tidyverse doesn’t offer, but do try to use this homework to apply what you have learned this week. Be prepared to share one of your findings on Monday!

Remember  
Before you submit, go through your weekend homework and make sure your code is following best practices as laid out in the coding_best_practice lesson.

## Step 1: Investigate the data
```{r}
library(tidyverse)

books <- read_csv("data/books.csv")
```

```{r}
glimpse(books)
View(books)
```

```{r}
books %>% 
  summarise(across(
    everything(), 
    ~sum(is.na(.x))
  ))
```

There are no "NA" missing values

```{r}
books_short <- books %>% #removed identifiers such as ISBN
  select(title:average_rating, language_code:publisher) 

books_short %>% 
  arrange(average_rating)
  
books_short %>% 
  arrange(ratings_count)
```

Some books have a rating figure despite having a total ratings count of 0. Where are these ratings coming from??

```{r}
books_short %>% 
  arrange(num_pages)
```

Some books have 0 pages. This does not seem likely. '0's should be replaced with NAs if we wish to analyse book length.

```{r}
books_short %>% 
  distinct(language_code)
```
There are 27 different language codes, English is given multiple times due to different versions (UK/US/Canada).

## Step 2 - Analysis

- QUESTION 1: Most and least popular books
MAX ANSWER
```{r}
books_short %>% 
  select(title, average_rating) %>% 
  slice_max(average_rating, n = 10) #why is n = 10 returning 22 rows? They all have a rating of 5 therefore cannot be split

books_short %>% 
  select(title, contains("rating")) %>% #the number of ratings recieved will be relevant to the average rating given
  slice_min(average_rating, n = 10)
```
The min average_ratings all also have 0 ratings. A better analysis might be those with 'ratings_count' > 0 or != 0

MIN ANSWER
```{r}
books_short %>% 
  select(title, contains("rating")) %>%
  filter(ratings_count != 0) %>% 
  slice_min(average_rating, n = 10)
```

The lowest rating received is actually 1 as all rows with an average rating of 0 also have a count of 0 ratings. All 0 ratings, or 0 count ratings, can be replaced with NA.
```{r}
books_fixed_rating <- books_short %>% 
  mutate(average_rating =
         if_else(ratings_count == 0,
                 NA,
                 average_rating))

books_fixed_rating %>% 
  arrange(average_rating)

books_fixed_rating %>% 
  summarise(no_rating = sum(is.na(average_rating)))
```
This has successfully removed 80 ratings which had a count of 0.

- QUESTION 2: Most and least popular authors

```{r}
books_fixed_rating %>% 
  select(authors, contains("rating")) %>% 
  slice_max(average_rating, n = 10)
```

Should 'NOT A BOOK' be removed from data set? 
```{r}
books_fixed_rating %>% 
  filter(authors == "NOT A BOOK")
```
These are not books, one is an audio CD for example. These should be removed, as well as 0 pages fixed.
```{r}
books_fixed <- books_fixed_rating %>% 
  filter(authors != "NOT A BOOK") %>% #completely remove the entries which are not actually books
  mutate(num_pages = if_else(num_pages == 0, NA, num_pages)) #there cannot be 0 pages so set this to NA

books_fixed %>% 
    summarise(across(everything(), 
    ~sum(is.na(.x))
    )
  )
```

ANSWER (Most and least popular authors)
```{r}
popular_authors <- books_fixed %>% 
  select(authors, contains("rating")) %>% 
  group_by(authors) %>% 
  summarise(average_rating = mean(average_rating), sum(ratings_count)) %>% 
  slice_max(average_rating, n = 10)
popular_authors
```

some authors only have one rating which does not seem representative. Anonymous is multiple people so not interesting in this context
```{r}
popular_authors <- books_fixed %>% 
  select(authors, contains("rating")) %>% 
  group_by(authors) %>% 
  filter(ratings_count > 10, authors != "Anonymous") %>% 
  summarise(average_rating = mean(average_rating), sum(ratings_count)) %>% 
  slice_max(average_rating, n = 10) %>% 
popular_authors

least_popular_authors <- books_fixed %>% 
  select(authors, contains("rating"), title) %>% 
  group_by(authors) %>% 
  filter(ratings_count > 10) %>%   
  summarise(average_rating = mean(average_rating), sum(ratings_count)) %>% 
  slice_min(average_rating, n = 10)
least_popular_authors
```

Some titles appear to be sets despite the individual books also being included
```{r}
books_fixed %>% 
  filter(str_detect(title, "Harry Potter")) %>% 
  arrange(title)
```

There are also duplicate titles but they have different author, pages, and publishing information

- QUESTION 3: Longest books / book length

```{r}
books_fixed %>% 
  select(title, num_pages, average_rating) %>% 
  slice_max(num_pages, n = 10)

books_fixed %>% 
  summarise(mean_num_pages = mean(num_pages, na.rm = TRUE),
            median_num_pages = median(num_pages, na.rm = TRUE),
            max_num_pages = max(num_pages, na.rm = TRUE),
            min_num_pages = min(num_pages, na.rm = TRUE))
```

- Question 4: How much do books vary from the average rating and book length

```{r}
avg_pages <- books_fixed %>% 
  summarise(avg_pages = mean(num_pages, na.rm = TRUE)) %>% 
  pull()

avg_rating <- books_fixed %>% 
  summarise(avg_rating = mean(average_rating, na.rm = TRUE)) %>% 
  pull()

books_fixed %>% 
  select(title, authors, num_pages, average_rating) %>% 
  mutate(avg_pages_diff = num_pages - avg_pages,
         avg_rating_diff = average_rating - avg_rating) %>% 
  arrange(desc(avg_rating_diff))
```

- QUESTION 5: How many books at each rating (rounded)

```{r}
books_round_ratings <- books_fixed %>% 
  mutate(rounded_rating = round(average_rating, 0))

books_round_ratings %>% 
  group_by(rounded_rating) %>% 
  summarise(count = n())
```

- QUESTION 6: When were the books published?
```{r}
books_fixed %>% 
  select(publication_date, title) %>% 
  arrange(desc(publication_date))
```

The books were published between 1900 and 2010

- Question 7: Languages
```{r}
books_fixed %>% 
  group_by(language_code) %>% 
  summarise(total = n()) %>% 
  arrange(desc(total))
```

English is the most popular langauge for books in this dataset.